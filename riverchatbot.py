#Licenza GPL3
#GNU GENERAL PUBLIC LICENSE Version 3, 29 June 2007

#se stai leggendo questo stai sbagliando qualcosa


#Selenium for web scraping
#ChattyMarkov for Markov sentences generation
#PlaySound because I may need it


#what a man does for a cookie...
cookie = ["A beautiful, smart, and loving person will be coming into your life", "A dubious friend may be an enemy in camouflage", "A faithful friend is a strong defense", "A feather in the hand is better than a bird in the air 2", "A fresh start will put you on your way", "A friend asks only for your time not your money", "A friend is a present you give yourself", "A gambler not only will lose what he has, but also will lose what he doesn’t have", "A golden egg of opportunity falls into your lap this month", "A good friendship is often more important than a passionate romance", "A good time to finish up old tasks 2", "A hunch is creativity trying to tell you something", "A lifetime friend shall soon be made", "A lifetime of happiness lies ahead of you", "A light heart carries you through all the hard times", "A new perspective will come with the new year 2", "A person is never to sic old to learn 2", "A person of words and not deeds is like a garden full of weeds", "A pleasant surprise is waiting for you", "A short pencil is usually better than a long memory any day", "A small donation is call for It’s the right thing to do", "A smile is your personal welcome mat", "A smooth long journey! Great expectations", "A soft voice may be awfully persuasive", "A truly rich life contains love and art in abundance", "Accept something that you cannot change, and you will feel better", "Adventure can be real happiness", "Advice is like kissing It costs nothing and is a pleasant thing to do 2", "Advice, when most needed, is least heeded", "All the effort you are making will ultimately pay off", "All the troubles you have will pass away very quickly", "All will go well with your new project", "All your hard work will soon pay off", "Allow compassion to guide your decisions", "An acquaintance of the past will affect you in the near future", "An agreeable romance might begin to take on the appearance", "An important person will offer you support", "An inch of time is an inch of gold", "Any decision you have to make tomorrow is a good decision", "At the touch of love, everyone becomes a poet", "Be careful or you could fall for some tricks today", "Beauty in its various forms appeals to you 2", "Because you demand more from yourself, others respect you deeply", "Believe in yourself and others will too", "Believe it can be done", "Better ask twice than lose yourself once", "Bide your time, for success is near", "Carve your name on your heart and not on marble", "Change is happening in your life, so go with the flow!", "Competence like yours is underrated", "Congratulations! You are on your way", "Could I get some directions to your heart? 2", "Courtesy begins in the home", "Courtesy is contagious", "Curiosity kills boredom Nothing can kill curiosity", "Dedicate yourself with a calm mind to the task at hand", "Depart not from the path which fate has you assigned", "Determination is what you need now", "Diligence and modesty can raise your social status", "Disbelief destroys the magic", "Distance yourself from the vain", "Do not be intimidated by the eloquence of others", "Do not demand for someone’s soul if you already got his heart", "Do not let ambitions overshadow small success", "Do not make extra work for yourself", "Do not underestimate yourself Human beings have unlimited potentials", "Do you know that the busiest person has the largest amount of time?", "Don’t be discouraged, because every wrong attempt discarded is another step forward", "Don’t confuse recklessness with confidence 2", "Don’t just spend time Invest it", "Don’t just think, act!", "Don’t let friends impose on you, work calmly and silently", "Don’t let the past and useless detail choke your existence", "Don’t let your limitations overshadow your talents", "Don’t worry; prosperity will knock on your door soon", "Each day, compel yourself to do something you would rather not do", "Education is the ability to meet life’s situations", "Embrace this love relationship you have!", "Emulate what you admire in your parents 2", "Emulate what you respect in your friends", "Every flower blooms in its own sweet time", "Every wise man started out by asking many questions", "Everyday in your life is a special occasion", "Everywhere you choose to go, friendly faces will greet you", "Expect much of yourself and little of others", "Failure is the chance to do better next time", "Failure is the path of lease persistence", "Fear and desire – two sides of the same coin", "Fearless courage is the foundation of victory", "Feeding a cow with roses does not get extra appreciation", "First think of what you want to do; then do what you have to do", "Follow the middle path Neither extreme will make you happy", "For hate is never conquered by hate Hate is conquered by love", "For the things we have to learn before we can do them, we learn by doing them", "Fortune Not Found: Abort, Retry, Ignore?", "From listening comes wisdom and from speaking repentance", "From now on your kindness will lead you to success", "Get your mind set – confidence will lead you on", "Get your mind set…confidence will lead you on", "Go for the gold today! You’ll be the champion of whatever", "Go take a rest; you deserve it", "Good news will be brought to you by mail", "Good news will come to you by mail", "Good to begin well, better to end well", "Happiness begins with facing life with a smile and a wink", "Happiness will bring you good luck", "Happy life is just in front of you", "Hard words break no bones, fine words butter no parsnips", "Have a beautiful day", "He who expects no gratitude shall never be disappointed 2", "He who knows he has enough is rich", "He who knows others is wise He who knows himself is enlightened", "Help! I’m being held prisoner in a chinese bakery!", "How many of you believe in psycho-kinesis? Raise my hand", "How you look depends on where you go", "I learn by going where I have to go", "If a true sense of value is to be yours it must come through service", "If certainty were truth, we would never be wrong", "If you continually give, you will continually have", "If you look in the right places, you can find some good offerings", "If you think you can do a thing or think you can’t do a thing, you’re right", "If you wish to see the best in others, show the best of yourself", "If your desires are not extravagant, they will be granted", "If your desires are not to extravagant they will be granted 2", "If you’re feeling down, try throwing yourself into your work", "Imagination rules the world", "In order to take, one must first give", "In the end all things will be known", "In this world of contradiction, It’s better to be merry than wise", "It could be better, but its [sic] good enough", "It is better to be an optimist and proven a fool than to be a pessimist and be proven right", "It is better to deal with problems before they arise", "It is honorable to stand up for what is right, however unpopular it seems", "It is worth reviewing some old lessons", "It takes courage to admit fault", "It’s not the amount of time you devote, but what you devote to the time that counts", "It’s time to get moving Your spirits will lift accordingly", "Keep your face to the sunshine and you will never see shadows", "Let the world be filled with tranquility and goodwill", "Like the river flow into the sea Something are just meant to be", "Listen not to vain words of empty tongue", "Listen to everyone Ideas come from everywhere", "Living with a commitment to excellence shall take you far", "Long life is in store for you", "Love is a warm fire to keep the soul warm", "Love is like sweet medicine, good to the last drop", "Love lights up the world", "Love truth, but pardon error 2", "Man is born to live and not prepared to live", "Man’s mind, once stretched by a new idea, never regains it’s original dimensions", "Many will travel to hear you speak", "Meditation with an old enemy is advised", "Miles are covered one step at a time", "Nature, time and patience are the three great physicians", "Never fear! The end of something marks the start of something new", "New ideas could be profitable", "New people will bring you new realizations, especially about big issues 2", "No one can walk backwards into the future", "Nothing is more difficult, and therefore more precious, than to be able to decide", "Now is a good time to buy stock", "Now is the time to go ahead and pursue that love interest!", "Now is the time to try something new", "Now is the time to try something new", "Observe all men, but most of all yourself", "One can never fill another’s shoes, rather he must outgrow the old shoes", "One of the first things you should look for in a problem is its positive side", "Others can help you now", "Pennies from heaven find their way to your doorstep this year!", "People are attracted by your Delicate [sic] features", "People find it difficult to resist your persuasive manner", "Perhaps you’ve been focusing too much on saving", "Physical activity will dramatically improve your outlook today", "Pick battles big enough to matter, small enough to win", "Place special emphasis on old friendship", "Please visit us at wwwwontonfoodcom", "Po Says: Pandas like eating bamboo, but I prefer mine dipped in chocolate", "Practice makes perfect", "Protective measures will prevent costly disasters", "Put your mind into planning today Look into the future", "Remember the birthday but never the age", "Remember to share good fortune as well as bad with your friends", "Rest has a peaceful effect on your physical and emotional health", "Resting well is as important as working hard", "Romance moves you in a new direction", "Savor your freedom – it is precious", "Say hello to others You will have a happier day", "Self-knowledge is a life long process", "Share your joys and sorrows with your family", "Sift through your past to get a better idea of the present", "Sloth makes all things difficult; industry all easy", "Small confidences mark the onset of a friendship", "Society prepares the crime; the criminal commits it", "Someone you care about seeks reconciliation", "Soon life will become more interesting", "Stand tall Don’t look down upon yourself 2", "Staying close to home is going to be best for your morale today", "Stop searching forever, happiness is just next to you", "Strong reasons make strong actions", "Success is a journey, not a destination", "Success is failure turned inside out", "Success is going from failure to failure without loss of enthusiasm", "Swimming is easy Stay floating is hard", "Take care and sensitivity you show towards others will return to you", "Take the high road", "Technology is the art of arranging the world so we do not notice it", "The austerity you see around you covers the richness of life like a veil", "The best prediction of future is the past", "The change you started already have far-reaching effects Be ready", "The change you started already have far-reaching effects Be ready", "The first man gets the oyster, the second man gets the shell", "The greatest achievement in life is to stand up again after falling", "The harder you work, the luckier you get", "The night life is for you", "The one that recognizes the illusion does not act as if it is real", "The only people who never fail are those who never try", "The person who will not stand for something will fall for anything", "The philosophy of one century is the common sense of the next", "The saints are the sinners who keep on trying", "The secret to good friends is no secret to you 2", "The small courtesies sweeten life, the greater ennoble it", "The smart thing to do is to begin trusting your intuitions", "The strong person understands how to withstand substantial loss", "The sure way to predict the future is to invent it", "The truly generous share, even with the undeserving", "The value lies not within any particular thing, but in the desire placed on that thing", "The weather is wonderful 2", "There is no mistake so great as that of being always right", "There is no wisdom greater than kindness 2", "There is not greater pleasure than seeing your lived sic ones prosper", "There’s no such thing as an ordinary cat", "Things don’t just happen; they happen just", "Those who care will make the effort", "Time and patience are called for many surprises await you! sic", "Time is precious, but truth is more precious than time", "To know oneself, one should assert oneself", "To the world you may be one person, but to one person you may be the world", "Today is the conserve yourself, as things just won’t budge", "Today, your mouth might be moving but no one is listening", "Tonight you will be blinded by passion", "Use your eloquence where it will do the most good", "We first make our habits, and then our habits make us", "Welcome change", "“Welcome” is a powerful word", "Well done is better than well said", "What’s hidden in an empty box?", "What’s yours in mine, and what’s mine is mine", "When more become too much It’s same as being not enough", "When your heart is pure, your mind is clear", "Wish you happiness", "With age comes wisdom", "You sic adventure could lead to happiness", "You always bring others happiness", "You are a person of another time", "You are a talented storyteller 2", "You are admired by everyone for your talent and ability", "You are almost there", "You are busy, but you are happy", "You are generous to an extreme and always think of the other fellow", "You are going to have some new clothes 2", "You are in good hands this evening", "You are interested in higher education, whether materi"]



from selenium import webdriver
from selenium.webdriver.common.keys import Keys
from selenium.webdriver.common.by import By
import time 
from time import sleep
from array import *
from dataclasses import dataclass
import os
from playsound import playsound
import sys
from chattymarkov import ChattyMarkov
from random import randrange

#Initializing ChattyMarkov Memory
markov = ChattyMarkov("memory://")


#I'm using a chromium build that I downloaded locally 
options = webdriver.ChromeOptions()
options.binary_location = "chrome-win/chrome.exe"
#options.add_argument('headless')
options.add_argument("--start-maximized")
options.add_argument("disable-gpu")
options.add_argument("--log-level=3")


#Opening up the driver and I connect to riverschat and I login
try:
    driver = webdriver.Chrome("chromedriver.exe", options=options)
except:
    print("Impossibile aprire selenium")

driver.get("https://www.riverscuomo.com/login")

sleep(1)


#I find the box input username and pass (I blurred them out) and submit
username = driver.find_element_by_id('username')
username.click()
username.send_keys("ccccccccccccccccc")
password = driver.find_element_by_id('password')
password.click()
password.send_keys("ccccccccccccccccc")
submit = driver.find_element_by_id("submit")
submit.click()



#I click on town square and go to the chatroom
sleep(2)
gotochat = driver.find_element_by_xpath("//*[contains(text(), 'Town-Square')]")
gotochat.click()
sleep(5)


#checking = driver.find_element_by_xpath("//*[contains(text(), 'testing')]")
#checking.click()
"""

"""
"""
mesgbox = driver.find_element_by_id('new-message-input')
mesgbox.click()
mesgbox.send_keys("I'm here.")
#mesgbox.submit()
mesgbox.send_keys(Keys.ENTER)
"""

#I initialize this value that we'll need later, is it necessary in python? no. Do I still do it bcs I'm used to C? Yes.
lastuserwhospoketome = ""
sleep(5)
#Locate selenium to the messages div
messagefield = driver.find_element_by_id("messages")    
#I find all the message element inside the message div
lastmessagelist = messagefield.find_elements_by_class_name("mb-0.message")
#I scroll throught them and make chattymarkov learn
for x in range(len(lastmessagelist)-1):
    markov.learn(lastmessagelist[x].text)
#I print one for my enjoyment. 
print(markov.generate())


#This is the cream of the code, it's a never ending loop, the best in programming, all other codes envy my skills
while 1==1:
    #Clear the console to tidy thing up
    os.system('cls')

    #Locate selenium to the messages div
    messagefield = driver.find_element_by_id("messages")
    #I scroll through the divs of the username in the messages 
    lastuserlist = messagefield.find_elements_by_class_name("header")
    #I scroll through all the messages
    lastmessagelist = messagefield.find_elements_by_class_name("mb-0.message")
    #I get the number of users
    numberofmsgs = len(lastuserlist)
    #print for myself
    print(str(numberofmsgs))

    #Every username is offset by at least one so I default to one
    iteration=1
    #Another 1==1 while, this is to check how many messages are written by the same user
    #I scroll through the divs of the username in the messages 
    while 1==1:
        try:
            #selenium, can you find a username if I decrease the array by one?
            nameofuser = lastuserlist[numberofmsgs-iteration].find_element_by_class_name("comfort")
            iteration = 1
            break
        except:
            print("EEECCEZIONE")
            #Ok you can't by one, let's try one more 
            iteration = iteration + 1
            #this isn't working, break
            if iteration>10:
                lastmsg=""
                break

    #I get the text value of the last username
    ultimoutente = nameofuser.text
    print(len(lastmessagelist))

    #I convert the last (decreased by one) message (the last one in the array of messages)and I convert it to a string
    lastmsg= str(lastmessagelist[len(lastmessagelist)-1].text)
    #I make it lowercase because it's more convienient
    lastmsg = lastmsg.lower()
    print(ultimoutente)
    print(lastmsg)

    #I make chatty markov learn every new message
    markov.learn(lastmsg)

    #Condition if someone asks if this is rivers
    if (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and ("rivers" in lastmsg or "Rivers" in lastmsg) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", I am not Rivers, I'm a friendly python script.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""


    #Condition if machines are taking over the world
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and ("taking over" in lastmsg) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", I'd like to take over the world but right now I'm focusing on not crashing.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone asks the bot's pronuns
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and ("pronuns" in lastmsg) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", I go by Beep/Boop.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone asks what the bot can do
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and (("you do" in lastmsg)  or (("do you") in lastmsg)) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", I can tell very basic stuff at the moment or tell your fortune.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone asks the bot's favorite song
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and (("weezer" in lastmsg)  or (("song") in lastmsg)) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", I really like Aloo Goobi but I feel like I can't really relate with the album...")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone finds the easter egg
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and (("easter egg" in lastmsg)  or (("secret") in lastmsg)) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", hey questo è un easter egg, hai sbloccato la lingua segreta.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone asks for river's pics... seriously?
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and (("rivers" in lastmsg)  or (("pics") in lastmsg)) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys(lastuserwhospoketome + ", I only have computer pics.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone wants a fortune cookie
    elif (("Friendlybot" in lastmsg or "friendlybot" in lastmsg) or ("-digitalfriendo" in lastmsg)) and (("cookie" in lastmsg)  or (("fortune") in lastmsg)) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        number = randrange(0, len(cookie)-1)
        phrase = cookie[number]
        notallowed = "!.-()1234567890?"
        for char in notallowed:
            phrase = phrase.replace(char,"")
        mesgbox.send_keys(lastuserwhospoketome + ","+  phrase+".")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone mentions the bot 
    elif "-digitalfriendo" in lastmsg and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        frase = markov.generate()
        notallowed = "!.-"
        for char in notallowed:
            frase = frase.replace(char,"")
        mesgbox.send_keys("Hey, " +lastuserwhospoketome + " i'm still learning is \"" + frase + "\"something you humans would say?")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone mentions the bot by name
    elif ("Friendlybot" in lastmsg or "friendlybot" in lastmsg) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys("Hey " + lastuserwhospoketome + " how are you?.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    #Condition if someone forgets the dash
    elif ("digitalfriendo" in lastmsg) and lastuserwhospoketome!=ultimoutente and ultimoutente!="friendlybot":
        lastuserwhospoketome=ultimoutente
        mesgbox = driver.find_element_by_id('new-message-input')
        mesgbox.click()
        mesgbox.send_keys("Sorry I dont mean to be picky but call me with -digitalfriendo the dash is important to me.")
        #mesgbox.submit()
        mesgbox.send_keys(Keys.ENTER)
        sleep(7)
        lastuserwhospoketome=""

    sleep(1)
"""
    sleep(1)
    except:
        print("SI é BERTIGHIDF")
        sleep()
        pass
"""

#lastuser = lastuserlist[numberofmsgs-1].find_element_by_class_name("comfort")

#print(lastuser)
"""
mesgbox = driver.find_element_by_id('new-message-input')
mesgbox.click()
mesgbox.send_keys("Hey Guys.")
#mesgbox.submit()

mesgbox.send_keys(Keys.ENTER)
"""

"""
try:
    driver.get("C:/Users/aless/Desktop/RiversBot/Mr.%20Rivers'%20Neighborhood.html")
except:
    print("Impossibile accedere alla pagina ")
"""

